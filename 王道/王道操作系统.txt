四、文件管理
4.1 文件组成：数据项(基本数据项,组合数据项) -> 记录 -> 文件(结构文件，无结构文件)
4.2 文件属性：名称,标识符,文件类型,文件位置,文件大小、时间、用户标识
4.3 文件分类：
    按用途分：系统文件,库文件,用户文件
    按保护级别分类：只读文件,读写文件,执行文件,不保护文件
    按信息流向分类：输入文件 输出文件 输入输出文件
    按数据形式分类： 源文件 目标文件 可执行文件
4.4 文件操作
    基本文件操作：创建文件 删除文件 读文件 写文件 截断文件 设置文件读写位置

    文件打开过程：将文件属性从外存复制到内存，并设置一个编号(索引)返回给用户。以后通过此编号(索引)对文件进行操作
    打开文件关联信息：文件指针 文件打开计数 文件磁盘位置 访问权限
    关闭文件：将打开的文件的编码(索引号)删除,并销毁其文件控制块,若文件被修改,则将修改保存到外存
4.5 文件结构
    逻辑结构：从用户角度观察文件的组织形式,用户直接处理数据及其数据结构,与存储设备特性无关
          有结构的记录文件：顺序,索引，索引顺序，直接文件和散列文件
                  有结构文件由若干记录组成. 所有记录长度相等等长文件,记录长度不等变长文件
          无结构的流式文件：
                  无结构文件由若干字符组成
    物理结构：从计算机角度看文件在外存上的存放组织形式,与存储设备特性关系很大
          文件组织形式：连续分配 链接分配 索引分配
4.5 目录结构
    目录功能：实现"按名存取" 提高检索速度 允许文件同名 允许文件共享
    文件目录也作为文件来处理，存放在外存中
4.5.1
    文件控制块 FCB
        一般包含的信息：文件名 文件结构 文件物理位置 存储控制信息 管理信息
    索引节点
        通过文件名形成索引项
        磁盘索引节点：存放在磁盘上的索引节点
        主要包括内容：文件主标识符 文件类型 文件存储权限 文件物理地址 文件长度 文件链接计数 文件存取时间
        内存索引节点：文件被打开时，磁盘索引节点被复制到内存中的节点
        增加内容：索引节点编号 状态 访问计数 逻辑设备号 链接指针
4.5.2.1 单级目录
    文件处理过程：新建 1.判断文件名在目录中是否唯一。2.没有冲突，在目录中找一个空表目，写入文件信息
                 访问 1.根据文件名查找目录项 2.文件存在，找到其物理地址 3.对其进行文件操作
                 删除 1.在目录中找到目录项。2.在目录项中找到物理地址。3.回收文件占用的存储空间 4. 清除其目录项
    优点：易于实现 管理简单
    缺点：不允许文件重名
4.5.2.2 二级目录
将文件目录分为主文件目录MFD 和 用户文件目录UFD。每个用户建立一个单独的用户文件目录，每个主文件记录各个用户目录的情况
   文件处理过程：新建  1.主文件目录是否有此用户条目，若没有，则系统为其在主目录中分配一个表目，并分配用于存放用户文件目录的存储空间。
                     2.若已有该用户条目或步骤一完成，在用户文件目录中为添加新文件的表目，填入相关信息
                访问 1.根据用户名在主文件目录中查找用户文件目录
                     2.根据文件名在其文件目录中找到目录项
                     3.读取用户文件目录信息，得到物理地址，进而访问文件
                删除 在用户文件目录中删除该文件的目录项，若删除后用户目录项为空，则可以在主文件目录中删除该用户的记录
   优点：解决重名问题，查找速度较快
   缺点：灵活性差 用户间合作访问不方便
4.5.2.3 树形目录(多级目录)
    目录树中非叶子节点均为目录文件，叶子文件为文件
    路径名 当前目录
    优点：方便分类 层次清晰 对文件进行有效管理和保护
    缺点：需要逐级访问中间节点，增加磁盘访问次数，影响访问速度
4.5.2.4 图形目录
    在原树目录上增加指向同一节点的有向边，构成有向无环图，使文件方便共享
    增加共享计数器，每当增加该节点的访问，计数器加1，用户删除对该节点的访问，计数器减1，仅当计数器为0时，才能真正删除该节点，否则只删除共享链
4.6 文件共享
    不同用户间共享一些文件完成任务，网络上不同计算机间需要进行通信，需要远程文件系统的共享功能
4.6.1 共享方式
    基于索引节点的共享方式(硬链接)
        将目录项的指针指向相同的索引节点，在索引节点中，采用文件计数值来统计索引节点的目录项数。文件被共享时，文件拥有者不能删除文件
    利用符号链实现文件共享(软连接)
       在文件目录项中新建一个新的目录项称为连接，新目录项包含被共享文件的路径名
       只有文件的拥有者有指向文件的指针，而共享该文件的其他用户只有该文件的路径名。
       当共享者访问以被拥有者删除的文件时，会访问失败，并删除该链接
4.7 文件保护
    防止文件受到物理破坏或非法访问
4.7.1 访问类型
      根据对文件的访问类型，控制
4.7.2 访问控制
      根据用户权限控制
      访问控制矩阵 访问控制表 用户权限表 口令与密码

4.8 文件系统的层次结构
    文件系统是指操作系统与文件管理相关的软件和数据的结合
4.8.1 层次结构
    用户接口
    文件目录系统
    存取控制验证
    逻辑文件系统与文件信息缓冲区
    物理文件系统 辅存分配模块 设备管理模块
4.9 目录实现
    线性表
    散列表
4.10 文件的实现
    外存分配方式，文件存储空间管理
4.10.1 外存分配方式
      文件在外存上的存储方式
      静态分配：文件建立时，一次性分配所需的全部空间
      动态分配：根据动态增长的文件长度进行分配
      分配方式：
               连续分配
               链接分配 隐式链接 显式链接
               索引分配 单级索引分配 两级索引分配 混合索引分配
4.10.2 文件存储空间管理
  空闲文件表 为所有空闲文件(连续的空闲区)建立一个目录，每个空闲文件在这个目录中占一个表目，表目包括 一个空闲块号，物理块号，空闲块数目
            当用户请求分配存储空间时，系统依次扫描空闲文件目录，找到满足要求的空闲文件为止.
            当用户撤销文件时，系统回收该文件所占用的空间，顺序扫描空闲文件目录，找到空表目，将释放空间的第一个物理块号，及其所占的块数填入表目中。若释放的物理块号其相邻的块为空闲块，则合并
  空闲块链表
  位示图法
  成组链接法
4.11 磁盘组织和管理
  磁盘的物理结构：柱面号，磁头号，扇区号
  磁盘结构中的信息：引导控制块，区分控制块，目录结构，文件控制块
  磁盘访问时间 = 寻道时间 +  旋转时间 + 传输时间
  寻道时间 = 从当前位置移动到目标磁道位置所用的时间
  旋转时间 = 旋转磁盘定位数据所在扇区所需要的时间(磁盘旋转半周的时间)
  传输时间 = 从磁盘上读取数据所用的时间

4.12 调度算法
先到先服务 FCFS
最短寻道时间 SSTF
扫描算法或电梯调度算法 SCAN
循环扫描 C-SCAN

4.13 磁盘管理
  4.13.1 磁盘格式化
        (1) 将磁盘分为一个或多个柱面组成的分区(C,D分区)
        (2) 对物理分区进行逻辑格式化(创建文件系统)，操作系统将初始的数据结构存储到磁盘上
  4.13.2 引导块
  4.12.3 坏扇区

五 设备管理
5.1 IO设备分类与IO管理任务
  5.1.1 IO分类
    按设备的使用特性分类：存储设备 人机交互设备 网络通信设备
    按信息交换单位分类：字符设备 块设备
    按传输速率分类：低速设备 中速设备 高速设备
    按设备的共享属性分类： 独占设备 共享设备 虚拟设备
  5.1.2 IO管理的任务和功能
    设备分配 设备处理 缓冲管理 设备独立性
    设备控制器： 设备控制器与处理器的接口 设备控制器与设备的接口 IO逻辑
    设备控制器功能： 1.接收和识别来自CPU的各种指令 2.实现CPU与设备控制器，设备控制器与设备之间的数据交换 3.记录设备的状态供CPU查询
                    4. 识别所控制的每个设备的地址 5.CPU输出的数据和设备向CPU输入数据进行缓冲 6.对输入输出数据进行差错控制
    IO控制方式： 程序直接控制方式 中断控制方式 MDA控制方式 通道控制方式
    IO软件层次结构 用户层软件 设备独立性软件 设备驱动程序 中断处理程序 硬件
  5.1.3 IO 核心子系统  提供的服务 IO调度 高速缓存与缓冲区 设备分配和回收 假脱机技术
         缓冲区 1.采用硬件缓冲器 2.在内存区划分一段内存区
         按照缓冲区的个数分类 单缓冲 双缓冲 循环缓冲 缓冲池

5.2 设备分配与回收
   5.2.1 设备管理中的数据结构
    DCT COCT CHCT SDT
   5.2.2 设备分配策略
     独享设备
     分享设备
     虚拟分配
  5.2.3 设备独立性 应用程序独立于具体使用的物理设备，用于提高设备分配的灵活性和设备利用率
           逻辑设备 逻辑设备表LUT
           物理设备
        实现设备独立性的方法 设备独立性软件 配置逻辑设备表 逻辑设备到物理设备的映射
        设备分配程序
        (1)单通路IO系统的设备分配
        (2)多通路IO系统的设备分配
        (3)
5.3 假脱机技术SPOOLing 通过共享设备来虚拟独占设备，将独占设备改造成共享设备
    假脱机技术SPOOLing的特点 提高了IO速度 设备并没有分配给任何进程 实现了虚拟设备功能 既是速度匹配技术也是虚拟设备技术
