######1.电子计算机的兴起
"现代计算机之父"   冯诺依曼
世界第一台通用计算机   ENIAC
第一台实用的存储程序式计算机  EDSAC

######2. 冯诺依曼的结构要点
运算器CA,控制器CC,存储器M，输入设备I，输出设备O

######3. 冯诺伊曼小故事
计算机指令执行步骤
取值，译码，执行，回写

######4. 计算机结构的简化模型
4.1 存储器 M：存储单元的位宽由设计计算机时对存储器的编址方式确定，若按字节编址，则每个存储单元可存放8位二进制数
    控制总线 读写完成控制信号
    地址总线 若地址总线宽度为n，则CPU能管理的存储单元最多为2^n个 -> MAR(地址寄存器，用于存放CPU正在读或写的存储单元的地址)
    数据总线 其宽度一般位存储单元位宽的整数倍-> MDR(数据寄存器，用于CPU正在读和即将写入存储单元的数据)

4.2 控制器 CC
  控制电路 指令译码
  IR(指令寄存器) 用于存放正在执行或即将执行的指令
  PC(程序计数器) 用于存放下一条指令的存储单元地址，具有自动增量的计数功能
  MAR(地址寄存器) 用于存放CPU正在读或写的存储单元的地址
  MDR(数据寄存器) 用于CPU正在读和即将写入存储单元的数据

4.3 运算器 CA
  ALU 算术逻辑单元的简称
  R0~Rn-1 通用寄存器 用于临时存放数据，数据可以来自存储器，也可以来自其他通用寄存器或ALU的输出

4.4 内部总线 用于CPU内部各个部件之间传递数据

######5. 计算机指令执行过程
取值： (1)控制器将指令地址送往存储器 (2)存储器按给定的地址读出指令内容送回控制器
译码： (1)控制器分析指令的操作性质 (2)控制器向有关部件发出指令所需的控制信号
执行:  (1)控制器从通用寄存器或存储器取出操作数 (2)控制器命令运算器对操作数进行指令规定的运算
回写： (1)将运算结果写入通用寄存器或存储器

######6. 计算机的输入输出 IO
输入设备I 输出设备O 外部记录介质R
南桥芯片 输入输出控制器
显卡

######7. 冯诺依曼结构和具体实
BIOS 芯片 只读存储器断电不丢失
CPU -> 北桥 -> 南桥 -> BIOS

######8. 设计自己的计算机

######9. x86体系结构
实模式 实地址模式，复位加电后首先进去实模式 运行系统初始化程序
保护模式 让操作系统加强对应用软件的控制，使得系统运行更加高效 操作系统和应用程序运行在保护模式
寄存器模型
  通用寄存器 数据寄存器 指针(变址)寄存器 标志寄存器 段寄存器
存储器的寻址
  8086 物理地址生成
    段基值左移4位+偏移量 =》
IA-32 存储器寻址

######10 X86指令类型
运算类指令
   算术 ADD ADC INC SUB SBB DEC CMP
   逻辑 NOT AND SHL SHR SAR

传送类指令  把数据或地址传送到寄存器或存储单元
   MOV PUSH POP
   堆栈结构所谓的“向下生长”，即栈底在堆栈的高地址端，而堆栈的栈基址(由SS寄存器确定)并不是栈底
转移类指令 无条件转移 条件转移
  直接转移 JMP
    短转移
    近转移
    远转移
  间接转移

控制类指令 控制CPU的功能 对标志位进行操作

######10 复杂X86指令
 串操作指令 对存储器中的数据串进行每次一个元素的操作
 MOVSB REP
 循环控制指令
 LOOPNE/LOOPNZ
 查表指令
 XLAT
 十进制调整指令
 DAA

 ###### 11 MIPS指令结构
 减少指令类型 降低指令复杂度
   MIPS 指令特点
     固定指令长度 32 bit
     简单寻址墨汁
     指令数量少，指令执行功能简单
     只有load和store指令可以访问存储器
     需要优秀编译器支持
####### 12 MPIS指令简介
  R: opcode(6) rs(5) rt(5) rd(5) shamt(5) funct(6)
  I：opcode(6) rs(5) rt(5) immediate(16)
  J: 条件分支 opcode(6) rs(5) rt(5) immediate(16)
     非条件分支 opcode(6) address(26)
####### 13 算术运算和逻辑运算
  算术运算
      R:
      I：addi 因为寄存器为32位，立即数位16位，需要对立即数进行符号拓展。拓展方法为 {16{imm[15]},imm}
  逻辑运算
      R:
      I：&addi 因为寄存器为32位，立即数位16位，需要对立即数进行0拓展。拓展方法为 {16{1‘b’0},imm}
      R:

####### 14 门电路的基本原理
  晶体管 MSO 互补型 CMOS
    n MOS 高电平导通
    p MOS 低电平导通

####### 15 寄存器的基本原理
  D 触发器
     具有存储信息能力的基本单元
     由若干逻辑门构成

####### 16 逻辑运算的实现

####### 17 加法与减法的实现
  半加器 将两个一位的二进制数相加
  全加器 由两个半加器构成

  进位不一定溢出，溢出不一定进位
  溢出判断 最高为的进位输入不等于最高为的进位输出
  MIPS 处理溢出
    （1） 将操作数看作有符号数，发出"溢出"时产生异常 add addi
    （2） 将操作数看作无符号数，不处理"溢出" addu addiu
  X86 对溢出的处理
    溢出标志OF  发生溢出OF置为1 未发生OF置位0
  补码 转换规则 按位取反，末位加一

####### 18 加法器的优化
  行波进位加法器 RCA
    结构特点 低位全加器的Cout连接到高位的Cin
  超前进位加法器 CLA
    提前进行进位计算 $C_{i+1} = G_i + P_i * C_i$

####### 19 乘法的运算过程
   二进制乘法

####### 20 乘法器实现

####### 21 乘法器优化1
加法移位并行

####### 22 乘法器优化2
减少不必要的硬件资源

####### 23  除法运算过程

####### 24 除法器的实现

####### 25 除法器的优化

####### 26 处理器的设计步骤
  1. 分析指令系统 得出数据通路的需求
  2. 为数据通路选择合适的组建
  3. 连接组件建立数据通路
  4. 分析每条指令的实现，以确定完整的控制逻辑
  5. 集成控制信号，形成完整的控制逻辑  

####### 27 数据通路的建立
  取值单元 IFU
####### 28 运算指令的控制信号
  取指令
  执行
  计算下一条指令
####### 29 访存指令的控制信号

####### 30 分支指令的控制信号

####### 31 控制信号的集成

####### 32 流水线的基本原理
流水线寄存器
流水线提高整个系统的吞吐率，并不会提高单个指令的执行速度

###### 33 流水线的优化
  不平衡流水线  =》超级流水线 提高吞吐率
                  增加了流水线级数
###### 34 超标量流水线
  超标量 通常具有两条或两条以上并行工作的流水线称为超标量结构
  单周期 -> 标量流水线 时间并行化 主要是对硬件进行切分
  标量流水线 -> 超标量流水线 空间并行化，需要成倍增加硬件资源

##### 35 流水线的冒险
  结构冒险 所需的硬件正在为之前的指令工作
  数据冒险 需要等待之前的指令完成数据读写
  控制冒险 需要根据之前的指令执行结果决定下一步的行为
解决方案
  1. 流水线停顿，产生空泡
  2. 指令和数据放在不同的存储器
  3. 寄存器读写发生冲突时 前半个时钟周期写,后半个时钟周期读，并设置独立的读写口
##### 36 数据冒险的处理
  数据冒险解决方法：
    软件nop
    硬件nop
    数据前递,旁路
  load_use冒险 流水线停顿加数据前递送

###### 37 控制冒险的处理
  延迟转移
###### 38 存储结构概况
  非易失性存储器 BIOS 硬盘
  存储器特性
    非易失性
    可读可写
    随机访问
    访问时间
  主存 DRAM < SRAM(cache)
  通用寄存器(CPU) > 高速缓存(SRAM) > 主存(DRAM) > 本地二级存储(DISK)
####### 39 DRAM 和 SRAM

###### 40 主存的工作原理
SDRAM访存过程
 1. 总线请求
 2. 预充电  
 行访问到列访问延迟 tRCD
 列访问到数据输出的延迟周期数 CL
 从内存控制器进行预充电开始到DRAM下一次接收行命令 行预充电(关闭行)延迟时间  tRP

 ###### 41 内存的发展
   SDR 时钟上升沿传输数据
   DDR 双倍数据率 时钟上升沿和下降沿都进行传输
   访存延迟 访存带宽

####### 42 高速缓存的工作原理
程序的局部性原理
  计算机程序从时间和空间上表现出局部性
    时间局部性 保存被频繁访问的主存单元数据
    空间局部性 以数据块为单位和主存进行数据交换
  写cache命中
   写穿透 数据同时写入主存和cache
   写返回 只写入cache，仅当该数据块被替换是才将数据写回主存
  写cache未命中
   写不分配 直接将数据写入主存
   写分配 将数据所在块读入cache后，再将数据写入cache
###### 43 高速缓存组织结构
   命中率 HIT RATE 访存请求中发生CAche的请求所占的比例
   命中时间 HIT TIME 从CACHE将命中数据返回的时间
   失效率 MISS RATE
   失效代价 MISS PENALTY
   平均访存时间 HIT TIME + MISS PENALTY * MISS RATE
cache 失效原因
  义务失效 第一次访问某一数据块 也称冷冻失效 无法避免
  容量失效 cache无法保存程序访问所需的所有数据块 可通过容量增加cache缓解
  冲突失效 多个存储位置映射到同一个cache位置
cache 映射策略
  直接映射
  二路组相连cache 四路组相连cache 全相连
cache 替换算法
  随机替换
  乱转替换
  LRU 硬件记录历史信息，选择最近最长时间未被使用的

####### 44 存储容量的计算
K:2^10 M:2^20 G:2^30

####### 45 中断和异常的来源
 外部中断
 内部中断

####### 46 中断向量表结构
8086
存储器内保留两个专用区域
 中断向量表区  00000H~003FFH 地址最低 1KB
 初始化程序区 FFFF0H~FFFFFH 地址最高 16B
中断向量 中断服务程序入口地址
    每个中断类型对应一个中断向量 4字节 前两个字节单元存放中断服务程序入口地址的偏移量IP 低字节在前，高字节在后
                                    后两个字节单元存放中断服务程序入口地址的段基值CS  低字节在前，高字节在后
        段加偏移产生物理地址
         逻辑地址 CS IP
         物理地址 CS0000+IP (段基值*16+偏移量)

###### 47 中断向量表的发展
  中断描述符表

###### 48 中断处理过程
  中断处理过程
   1.关中断  不再接收外部中断请求
   2.保护断点  将发生中断处的指令地址压入堆栈
   3.识别中断来源  CPU识别中断来源，确定中断类型号
   4.保护现场  将中断处寄存器压栈
   5.执行中断处理服务程序 转到中断服务入口开始执行，适当重新放开中断以便响应高优先级中断
   6.恢复中断 IRET指令 弹出IP,CS,FLAGS
STI IF置1
CLT IT置0

###### 49 内部中断分类说明
0 除法中断
1 单步中断  TF置1，CPU处于单步工作方式
3 断点中断  通过断点定位再跟踪
4 溢出中断 INFO中断 若溢出标志位为1，则引起类型4的内部中段
INT n 除了类型3是单字节外 其余都是2字节长指令

出单步中断外所有内部中断的优先级都比外部高

####### 50 基于中断功能调用
BIOS中断
  提供设备加电自检，引导装入，主要IO设备处理程序及接口控制等功能
DOS中断 只有一个中断类型号 21H
  包含最常用的功能程序，分别实现文件管理，存储管理，作业管理和设备管理

###### 51 输入输出接口的基本功能
1. 数据缓冲 解决CPU和外设之间的速度差距
2. 提供联络信息 协调与同步数据转换
3. 信号与信息格式的转换
4. 设备选择
5. 中断管理
6. 可编程功能
 并行接口电路
 8根数据信号
 两个握手信号

###### 52 输入输出接口的编制方式
 IO端口 内部包含一组称为IO端口的寄存器
 每个IO端口都有自己的端口地址
IO 编制方式
  IO端口和存储器分开编址
    IN/OUT寻址
     端口地址为0-255
      直接寻址 用一个字节立即数指定端口地址
      间接寻址 用DX的内容指定端口地址
    端口地址大于 255
      间接寻址 用DX的内容指定端口地址
    优点
     不占用存储器空间
     指令编码短，执行速度快
     指令地址码短，地址译码方便
     采用单独IO编码，逻辑清晰
  IO端口和存储器统一编址
    优点
      可以用访问存储器的指令来访问IO端口，直接对IO端口内的数据进行处理
      可以将CPU的IO操作与访问存储器操作统一设计为一套控制逻辑，简化内部结构，减少CPU的引脚数据
    缺点
      存储器空间被占用，存储地址空间减少
      指令比直接IO指令要长，因为执行时间也较长
####### 53 输入输出控制方式
IO控制方式分类
  程序控制方式
    无条件传输方式
    程序查询传送方式



课本
MIPS 大端模式
